
# https://towardsdatascience.com/python-garbage-collection-article-4a530b0992e3

import sys

def obj_size_fmt(num):
    if num < 10 ** 3:
        return "{:.2f}{}".format(num, "B")
    elif ((num >= 10 ** 3) & (num < 10 ** 6)):
        return "{:.2f}{}".format(num / (1.024 * 10 ** 3), "KB")
    elif ((num >= 10 ** 6) & (num < 10 ** 9)):
        return "{:.2f}{}".format(num / (1.024 * 10 ** 6), "MB")
    else:
        return "{:.2f}{}".format(num / (1.024 * 10 ** 9), "GB")


def memory_usage():
    memory_usage_by_variable = pd.DataFrame({k: sys.getsizeof(v) \
                                             for (k, v) in globals().items()}, index=['Size'])
    memory_usage_by_variable = memory_usage_by_variable.T
    memory_usage_by_variable = memory_usage_by_variable \
        .sort_values(by='Size', ascending=False).head(10)
    memory_usage_by_variable['Size'] = memory_usage_by_variable['Size'].apply(lambda x: obj_size_fmt(x))
    return memory_usage_by_variable


def get_mem(df):
    total_mem = df.memory_usage().sum() / (1024 ** 2)
    print(total_mem)